// ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÍ∞Ñ ÌëúÏãú (ÌïúÍµ≠ÏãúÍ∞Ñ Í∏∞Ï§Ä)
        setInterval(() => {
            const koreaTime = new Date(getKoreaTime());
            const timeString = koreaTime.toLocaleString('ko-KR', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                timeZone: KOREA_TIMEZONE
            });
            
            const lastUpdate = lastUpdateTimestamp[currentPeriod];
            const lastUpdateTime = lastUpdate ? 
                new Date(lastUpdate).toLocaleString('ko-KR', { timeZone: KOREA_TIMEZONE }) :
                'ÏóÖÎç∞Ïù¥Ìä∏ ÌïÑÏöî';
            
            document.getElementById('lastUpdate').textContent = 
                `ÎßàÏßÄÎßâ Î∞∞Ïπò ÏóÖÎç∞Ïù¥Ìä∏: ${lastUpdateTime} | ÌòÑÏû¨ ÌïúÍµ≠ÏãúÍ∞Ñ: ${timeString}`;
        }, 1000); // 1Ï¥àÎßàÎã§ ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏
                <!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÌïúÍµ≠Ïù∏ ÎØ∏Íµ≠ Î†àÎ≤ÑÎ¶¨ÏßÄ ETF Í±∞ÎûòÏàúÏúÑ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1f2937 0%, #374151 20%, #dc2626 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .controls {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            background: #f0f0f0;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .tab-btn.active {
            background: linear-gradient(45deg, #dc2626, #991b1b);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(220, 38, 38, 0.6);
            border: 2px solid #fca5a5;
        }

        .tab-btn:hover:not(.active) {
            background: linear-gradient(45deg, #fca5a5, #f87171);
            color: #7f1d1d;
            transform: translateY(-1px);
        }

        .filters {
            display: flex;
            gap: 15px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-group label {
            font-weight: 600;
            color: #555;
        }

        select, input {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #dc2626;
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.2);
        }

        .ranking-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .ranking-header {
            background: linear-gradient(45deg, #dc2626, #991b1b);
            color: white;
            padding: 20px;
            text-align: center;
            border-bottom: 4px solid #fca5a5;
            box-shadow: 0 4px 20px rgba(220, 38, 38, 0.4);
        }

        .ranking-header h2 {
            font-size: 1.5em;
            margin-bottom: 5px;
        }

        .ranking-table {
            width: 100%;
            border-collapse: collapse;
        }

        .ranking-table th {
            background: #f8f9fa;
            padding: 15px 10px;
            text-align: left;
            font-weight: 600;
            color: #555;
            border-bottom: 2px solid #dee2e6;
            font-size: 14px;
        }

        .ranking-table td {
            padding: 12px 10px;
            border-bottom: 1px solid #eee;
            font-size: 14px;
        }

        .ranking-table tr:hover {
            background: rgba(220, 38, 38, 0.08);
            transform: scale(1.01);
            transition: all 0.2s ease;
            border-left: 4px solid #dc2626;
        }

        .rank-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            font-weight: bold;
            color: white;
            font-size: 12px;
        }

        .rank-1 { background: linear-gradient(45deg, #FFD700, #FFA500); box-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }
        .rank-2 { background: linear-gradient(45deg, #C0C0C0, #A9A9A9); box-shadow: 0 0 8px rgba(192, 192, 192, 0.5); }
        .rank-3 { background: linear-gradient(45deg, #CD7F32, #B8860B); box-shadow: 0 0 6px rgba(205, 127, 50, 0.5); }
        .rank-other { background: linear-gradient(45deg, #dc2626, #991b1b); box-shadow: 0 0 8px rgba(220, 38, 38, 0.4); }

        .etf-name {
            font-weight: 600;
            color: #333;
        }

        .etf-ticker {
            color: #666;
            font-size: 12px;
            margin-left: 8px;
        }

        .volume-bar {
            height: 20px;
            background: linear-gradient(90deg, #2563eb, #dc2626);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }

        .volume-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 11px;
            font-weight: 600;
        }

        .change-positive {
            color: #dc2626;
            font-weight: 700;
            text-shadow: 0 0 4px rgba(220, 38, 38, 0.3);
        }

        .change-negative {
            color: #2563eb;
            font-weight: 600;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #dc2626;
            border-right: 4px solid #fca5a5;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
            box-shadow: 0 0 10px rgba(220, 38, 38, 0.3);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-top: 3px solid #dc2626;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(220, 38, 38, 0.2);
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #dc2626;
            margin-bottom: 5px;
            text-shadow: 0 0 8px rgba(220, 38, 38, 0.3);
        }

        .stat-label {
            color: #666;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .container { padding: 10px; }
            .header h1 { font-size: 2em; }
            .filters { flex-direction: column; }
            .ranking-table { font-size: 12px; }
            .ranking-table th, .ranking-table td { padding: 8px 5px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üá∫üá∏ ÌïúÍµ≠Ïù∏ ÎØ∏Íµ≠ Î†àÎ≤ÑÎ¶¨ÏßÄ ETF Í±∞ÎûòÏàúÏúÑ</h1>
            <p>‚≠ê Stars & Stripes Ïä§ÌÉÄÏùº Ïã§ÏãúÍ∞Ñ Í±∞ÎûòÎüâ Í∏∞Î∞ò Î†àÎ≤ÑÎ¶¨ÏßÄ ÏÉÅÌíà Î∂ÑÏÑù ‚≠ê</p>
        </header>

        <div class="controls">
            <div class="tab-buttons">
                <button class="tab-btn active" onclick="switchPeriod('daily')">ÏùºÎ≥Ñ</button>
                <button class="tab-btn" onclick="switchPeriod('weekly')">Ï£ºÎ≥Ñ</button>
                <button class="tab-btn" onclick="switchPeriod('monthly')">ÏõîÎ≥Ñ</button>
            </div>
            
            <div class="filters">
                <div class="filter-group">
                    <label for="rankRange">ÏàúÏúÑ:</label>
                    <select id="rankRange" onchange="updateRanking()">
                        <option value="10">Top 10</option>
                        <option value="25">Top 25</option>
                        <option value="50">Top 50</option>
                        <option value="100">Top 100</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="leverageType">Î†àÎ≤ÑÎ¶¨ÏßÄ:</label>
                    <select id="leverageType" onchange="updateRanking()">
                        <option value="all">Ï†ÑÏ≤¥</option>
                        <option value="2x">2Î∞∞</option>
                        <option value="3x">3Î∞∞</option>
                        <option value="inverse">Ïù∏Î≤ÑÏä§</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="searchTicker">Í≤ÄÏÉâ:</label>
                    <input type="text" id="searchTicker" placeholder="Ìã∞Ïª§ Í≤ÄÏÉâ" onkeyup="searchETF()">
                </div>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalVolume">‚Ç©1.2Ï°∞</div>
                <div class="stat-label">Ï¥ù Í±∞ÎûòÎåÄÍ∏à</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="activeETFs">47</div>
                <div class="stat-label">ÌôúÏÑ± ETF Ïàò</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgChange">+2.3%</div>
                <div class="stat-label">ÌèâÍ∑† ÏàòÏùµÎ•†</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="topGainer">TQQQ</div>
                <div class="stat-label">ÏµúÍ≥† ÏàòÏùµÎ•†</div>
            </div>
        </div>

        <div class="ranking-container">
            <div class="ranking-header">
                <h2 id="rankingTitle">ÏùºÎ≥Ñ Í±∞ÎûòÏàúÏúÑ Top 10</h2>
                <p id="lastUpdate">Î∞∞Ïπò ÏãúÏä§ÌÖú Ï¥àÍ∏∞Ìôî Ï§ë...</p>
                <div style="margin-top: 10px; font-size: 12px; opacity: 0.8;">
                    üìÖ ÌïúÍµ≠ÏãúÍ∞Ñ 23:59:59 Í∏∞Ï§Ä ÏùºÏùº Î∞∞Ïπò | üîÑ ÌïòÎ£® 1Ìöå ÏûêÎèô ÏóÖÎç∞Ïù¥Ìä∏ | üíæ Î°úÏª¨ Ï∫êÏã±
                </div>
            </div>
            
            <div id="loadingDiv" class="loading" style="display: none;">
                <div class="spinner"></div>
                <p>Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...</p>
            </div>

            <table class="ranking-table" id="rankingTable">
                <thead>
                    <tr>
                        <th>ÏàúÏúÑ</th>
                        <th>ETFÎ™Ö</th>
                        <th>ÌòÑÏû¨Í∞Ä</th>
                        <th>Î≥ÄÎèôÎ•†</th>
                        <th>Í±∞ÎûòÎüâ</th>
                        <th>Í±∞ÎûòÎåÄÍ∏à</th>
                        <th>Î†àÎ≤ÑÎ¶¨ÏßÄ</th>
                    </tr>
                </thead>
                <tbody id="rankingBody">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Ïù∏Í∏∞ÏûàÎäî ÎØ∏Íµ≠ Î†àÎ≤ÑÎ¶¨ÏßÄ ETF Î¶¨Ïä§Ìä∏ (ÌïúÍµ≠Ïù∏Îì§Ïù¥ ÎßéÏù¥ Í±∞ÎûòÌïòÎäî Ï¢ÖÎ™©Îì§)
        const popularLeverageETFs = [
            'TQQQ', 'SQQQ', 'UPRO', 'SPXU', 'TECL', 'TECS', 'QLD', 'QID', 'SSO', 'SDS',
            'LABU', 'LABD', 'FNGU', 'FNGD', 'UDOW', 'SDOW', 'TNA', 'TZA', 'FAS', 'FAZ',
            'CURE', 'SICK', 'WEBL', 'WEBS', 'NAIL', 'RETL', 'ERX', 'ERY', 'DPST', 'DRIP',
            'SOXL', 'SOXS', 'BULZ', 'ARKK', 'GUSH', 'BOIL', 'KOLD', 'JNUG', 'JDST', 'NUGT',
            'DUST', 'UCO', 'SCO', 'UNG', 'DGAZ', 'UVXY', 'SVXY', 'SPXL', 'SPXS', 'TMF',
            'TMV', 'UUP', 'UDN', 'USO', 'UGA', 'DBA', 'CORN', 'VIXY', 'XIV', 'VXX'
        ];

        // ETF ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Îß§Ìïë
        const etfDetails = {
            'TQQQ': { name: 'ProShares UltraPro QQQ', leverage: '3x', category: 'tech' },
            'SQQQ': { name: 'ProShares UltraPro Short QQQ', leverage: 'inverse', category: 'tech' },
            'UPRO': { name: 'ProShares UltraPro S&P500', leverage: '3x', category: 'broad' },
            'SPXU': { name: 'ProShares UltraPro Short S&P500', leverage: 'inverse', category: 'broad' },
            'TECL': { name: 'Direxion Daily Technology Bull 3X', leverage: '3x', category: 'tech' },
            'TECS': { name: 'Direxion Daily Technology Bear 3X', leverage: 'inverse', category: 'tech' },
            'QLD': { name: 'ProShares Ultra QQQ', leverage: '2x', category: 'tech' },
            'QID': { name: 'ProShares UltraShort QQQ', leverage: 'inverse', category: 'tech' },
            'SSO': { name: 'ProShares Ultra S&P500', leverage: '2x', category: 'broad' },
            'SDS': { name: 'ProShares UltraShort S&P500', leverage: 'inverse', category: 'broad' },
            'LABU': { name: 'Direxion Daily S&P Biotech Bull 3X', leverage: '3x', category: 'biotech' },
            'LABD': { name: 'Direxion Daily S&P Biotech Bear 3X', leverage: 'inverse', category: 'biotech' },
            'FNGU': { name: 'MicroSectors FANG+ Index 3X Bull', leverage: '3x', category: 'tech' },
            'FNGD': { name: 'MicroSectors FANG+ Index 3X Bear', leverage: 'inverse', category: 'tech' },
            'SOXL': { name: 'Direxion Daily Semiconductor Bull 3X', leverage: '3x', category: 'tech' },
            'SOXS': { name: 'Direxion Daily Semiconductor Bear 3X', leverage: 'inverse', category: 'tech' },
            'BULZ': { name: 'MicroSectors FANG+ Index 3X Bull', leverage: '3x', category: 'tech' },
            'ARKK': { name: 'ARK Innovation ETF', leverage: '1x', category: 'tech' },
            'TNA': { name: 'Direxion Daily Small Cap Bull 3X', leverage: '3x', category: 'small' },
            'TZA': { name: 'Direxion Daily Small Cap Bear 3X', leverage: 'inverse', category: 'small' },
            'FAS': { name: 'Direxion Daily Financial Bull 3X', leverage: '3x', category: 'financial' },
            'FAZ': { name: 'Direxion Daily Financial Bear 3X', leverage: 'inverse', category: 'financial' }
        };

        let currentPeriod = 'daily';
        let currentData = [];
        let filteredData = [];
        let realTimeData = [];

        // Alpha Vantage API ÏÑ§Ï†ï
        const ALPHA_VANTAGE_API_KEY = 'IICHBIPDPP6Q1GUZ';
        const ALPHA_VANTAGE_BASE_URL = 'https://www.alphavantage.co/query';

        // CORS ÌîÑÎ°ùÏãú ÏÑúÎ≤ÑÎì§ (Alpha Vantage API Ìò∏Ï∂úÏö©)
        const CORS_PROXIES = [
            'https://api.allorigins.win/raw?url=',
            'https://cors-anywhere.herokuapp.com/',
            'https://api.codetabs.com/v1/proxy?quest='
        ];

        let currentProxyIndex = 0;

        // Alpha Vantage API Ìò∏Ï∂ú Ìï®Ïàò
        async function fetchFromAlphaVantage(symbol, retryCount = 0) {
            const params = new URLSearchParams({
                function: 'GLOBAL_QUOTE',
                symbol: symbol,
                apikey: ALPHA_VANTAGE_API_KEY
            });
            
            const url = `${ALPHA_VANTAGE_BASE_URL}?${params}`;
            const proxyUrl = CORS_PROXIES[currentProxyIndex] + encodeURIComponent(url);
            
            try {
                console.log(`üì° Alpha Vantage API Ìò∏Ï∂ú: ${symbol}`);
                
                const response = await fetch(proxyUrl, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                // API ÏùëÎãµ ÌôïÏù∏
                if (data['Error Message']) {
                    throw new Error(`Alpha Vantage Error: ${data['Error Message']}`);
                }
                
                if (data['Note']) {
                    console.warn(`‚ö†Ô∏è API Ï†úÌïú: ${data['Note']}`);
                    throw new Error('API_LIMIT');
                }
                
                const quote = data['Global Quote'];
                if (!quote) {
                    throw new Error('Invalid API response structure');
                }
                
                // Îç∞Ïù¥ÌÑ∞ ÌååÏã±
                return {
                    symbol: quote['01. symbol'],
                    price: parseFloat(quote['05. price']) || 0,
                    change: parseFloat(quote['09. change']) || 0,
                    changePercent: parseFloat(quote['10. change percent']?.replace('%', '')) || 0,
                    volume: parseInt(quote['06. volume']) || 0,
                    high: parseFloat(quote['03. high']) || 0,
                    low: parseFloat(quote['04. low']) || 0,
                    previousClose: parseFloat(quote['08. previous close']) || 0
                };
                
            } catch (error) {
                console.error(`‚ùå ${symbol} API Ìò∏Ï∂ú Ïã§Ìå®:`, error.message);
                
                // Îã§Î•∏ ÌîÑÎ°ùÏãúÎ°ú Ïû¨ÏãúÎèÑ
                if (retryCount < CORS_PROXIES.length - 1) {
                    currentProxyIndex = (currentProxyIndex + 1) % CORS_PROXIES.length;
                    console.log(`üîÑ ÌîÑÎ°ùÏãú Î≥ÄÍ≤ΩÌïòÏó¨ Ïû¨ÏãúÎèÑ: ${CORS_PROXIES[currentProxyIndex]}`);
                    return await fetchFromAlphaVantage(symbol, retryCount + 1);
                }
                
                // Î™®Îì† Ïû¨ÏãúÎèÑ Ïã§Ìå® Ïãú null Î∞òÌôò
                return null;
            }
        }

        // Î∞∞ÏπòÎ°ú ETF Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞ (API Ï†úÌïú Í≥†Î†§)
        async function fetchETFBatch(symbols, batchSize = 5) {
            const results = [];
            const delay = 12000; // Alpha Vantage Î¨¥Î£å ÌîåÎûú: Î∂ÑÎãπ 5Ìöå Ï†úÌïú
            
            console.log(`üìä ${symbols.length}Í∞ú ETF Îç∞Ïù¥ÌÑ∞ ÏàòÏßë ÏãúÏûë (Î∞∞Ïπò ÌÅ¨Í∏∞: ${batchSize})`);
            
            for (let i = 0; i < symbols.length; i += batchSize) {
                const batch = symbols.slice(i, i + batchSize);
                console.log(`üìà Î∞∞Ïπò ${Math.floor(i/batchSize) + 1}: ${batch.join(', ')}`);
                
                // Î∞∞Ïπò ÎÇ¥ Î≥ëÎ†¨ Ï≤òÎ¶¨
                const batchPromises = batch.map(symbol => fetchFromAlphaVantage(symbol));
                const batchResults = await Promise.all(batchPromises);
                
                // Ïú†Ìö®Ìïú Í≤∞Í≥ºÎßå Ï∂îÍ∞Ä
                batchResults.forEach((result, idx) => {
                    if (result) {
                        const symbol = batch[idx];
                        const etfInfo = etfDetails[symbol] || {
                            name: `${symbol} ETF`,
                            leverage: 'Unknown',
                            category: 'other'
                        };
                        
                        results.push({
                            ticker: result.symbol,
                            name: etfInfo.name,
                            price: result.price,
                            change: result.changePercent,
                            volume: result.volume,
                            leverage: etfInfo.leverage,
                            category: etfInfo.category,
                            high: result.high,
                            low: result.low,
                            previousClose: result.previousClose,
                            koreanPopularity: popularLeverageETFs.includes(symbol) ? 
                                Math.random() * 0.3 + 0.7 : Math.random() * 0.4 + 0.3
                        });
                        
                        console.log(`‚úÖ ${symbol}: ${result.price} (${result.changePercent > 0 ? '+' : ''}${result.changePercent.toFixed(2)}%)`);
                    }
                });
                
                // API Ï†úÌïú Ï§ÄÏàòÎ•º ÏúÑÌïú ÎåÄÍ∏∞ (ÎßàÏßÄÎßâ Î∞∞ÏπòÍ∞Ä ÏïÑÎãå Í≤ΩÏö∞)
                if (i + batchSize < symbols.length) {
                    console.log(`‚è≥ API Ï†úÌïú Ï§ÄÏàòÎ•º ÏúÑÌï¥ ${delay/1000}Ï¥à ÎåÄÍ∏∞...`);
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
            
            console.log(`üéØ Ï¥ù ${results.length}Í∞ú ETF Îç∞Ïù¥ÌÑ∞ ÏàòÏßë ÏôÑÎ£å`);
            return results;
        }

        // Alpha Vantage Í∏∞Î∞ò Ïã§ÏãúÍ∞Ñ Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
        async function updateRealTimeData() {
            try {
                showLoading();
                
                // ÏÉÅÏúÑ Ïù∏Í∏∞ Ï¢ÖÎ™©Î∂ÄÌÑ∞ Ïö∞ÏÑ† ÏàòÏßë (API Ï†úÌïú Í≥†Î†§)
                const prioritySymbols = popularLeverageETFs.slice(0, 15); // ÏÉÅÏúÑ 15Í∞úÎßå
                console.log('üöÄ Alpha Vantage APIÎ•º ÌÜµÌïú Ïã§ÏãúÍ∞Ñ Îç∞Ïù¥ÌÑ∞ ÏàòÏßë ÏãúÏûë');
                
                const apiData = await fetchETFBatch(prioritySymbols, 3); // Î∞∞Ïπò ÌÅ¨Í∏∞ 3ÏúºÎ°ú ÏïàÏ†ÑÌïòÍ≤å
                
                if (apiData.length > 0) {
                    // API Îç∞Ïù¥ÌÑ∞ + ÏãúÎÆ¨Î†àÏù¥ÏÖò Îç∞Ïù¥ÌÑ∞ Í≤∞Ìï©
                    const remainingSymbols = popularLeverageETFs.slice(15);
                    const simulatedData = remainingSymbols.map(symbol => {
                        const etfInfo = etfDetails[symbol] || {
                            name: `${symbol} ETF`,
                            leverage: '3x',
                            category: 'other'
                        };
                        
                        return {
                            ticker: symbol,
                            name: etfInfo.name,
                            price: Math.random() * 100 + 20,
                            change: (Math.random() - 0.5) * 8,
                            volume: Math.floor(Math.random() * 30000000) + 5000000,
                            leverage: etfInfo.leverage,
                            category: etfInfo.category,
                            koreanPopularity: 0.5
                        };
                    });
                    
                    realTimeData = [...apiData, ...simulatedData];
                    
                    console.log(`üéä ÏÑ±Í≥µ! Ïã§Ï†ú Îç∞Ïù¥ÌÑ∞ ${apiData.length}Í∞ú + ÏãúÎÆ¨Î†àÏù¥ÏÖò ${simulatedData.length}Í∞ú`);
                } else {
                    throw new Error('API Îç∞Ïù¥ÌÑ∞ ÏàòÏßë Ïã§Ìå®');
                }
                
                hideLoading();
                updateRanking();
                
            } catch (error) {
                console.error('‚ùå Alpha Vantage Îç∞Ïù¥ÌÑ∞ ÏàòÏßë Ïã§Ìå®:', error);
                hideLoading();
                
                // Ìè¥Î∞± Îç∞Ïù¥ÌÑ∞Î°ú ÎåÄÏ≤¥
                console.log('üîÑ Ìè¥Î∞± Îç∞Ïù¥ÌÑ∞Î°ú Ï†ÑÌôò');
                generateFallbackData();
                updateRanking();
            }
        }

        // Ìè¥Î∞± Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ±
        function generateFallbackData() {
            const fallbackData = [];
            for (let i = 0; i < popularLeverageETFs.length; i++) {
                const symbol = popularLeverageETFs[i];
                const etfInfo = etfDetails[symbol] || {
                    name: `Leveraged ETF ${symbol}`,
                    leverage: '3x',
                    category: 'other'
                };

                fallbackData.push({
                    ticker: symbol,
                    name: etfInfo.name,
                    price: Math.random() * 100 + 20,
                    change: (Math.random() - 0.5) * 8,
                    volume: Math.floor(Math.random() * 40000000) + 10000000,
                    leverage: etfInfo.leverage,
                    category: etfInfo.category,
                    koreanPopularity: 1.0
                });
            }
            realTimeData = fallbackData;
        }

        // Í∏∞Ï°¥ ÌïòÎìúÏΩîÎî©Îêú Îç∞Ïù¥ÌÑ∞ (Ìè¥Î∞±Ïö©)
        const leverageETFs = [
            {ticker: 'TQQQ', name: 'ProShares UltraPro QQQ', price: 65.42, change: 3.2, volume: 45000000, leverage: '3x', category: 'tech'},
            {ticker: 'SQQQ', name: 'ProShares UltraPro Short QQQ', price: 12.34, change: -3.1, volume: 38000000, leverage: 'inverse', category: 'tech'},
            {ticker: 'UPRO', name: 'ProShares UltraPro S&P500', price: 54.21, change: 2.8, volume: 35000000, leverage: '3x', category: 'broad'},
            {ticker: 'SPXU', name: 'ProShares UltraPro Short S&P500', price: 8.76, change: -2.7, volume: 32000000, leverage: 'inverse', category: 'broad'},
            {ticker: 'TECL', name: 'Direxion Daily Technology Bull 3X', price: 42.18, change: 4.1, volume: 28000000, leverage: '3x', category: 'tech'},
            {ticker: 'TECS', name: 'Direxion Daily Technology Bear 3X', price: 7.89, change: -4.0, volume: 25000000, leverage: 'inverse', category: 'tech'},
            {ticker: 'QLD', name: 'ProShares Ultra QQQ', price: 89.65, change: 2.1, volume: 22000000, leverage: '2x', category: 'tech'},
            {ticker: 'QID', name: 'ProShares UltraShort QQQ', price: 15.32, change: -2.0, volume: 20000000, leverage: 'inverse', category: 'tech'},
            {ticker: 'SSO', name: 'ProShares Ultra S&P500', price: 78.54, change: 1.9, volume: 18000000, leverage: '2x', category: 'broad'},
            {ticker: 'SDS', name: 'ProShares UltraShort S&P500', price: 11.87, change: -1.8, volume: 16000000, leverage: 'inverse', category: 'broad'},
            {ticker: 'LABU', name: 'Direxion Daily S&P Biotech Bull 3X', price: 15.67, change: 5.3, volume: 15000000, leverage: '3x', category: 'biotech'},
            {ticker: 'LABD', name: 'Direxion Daily S&P Biotech Bear 3X', price: 18.92, change: -5.2, volume: 14000000, leverage: 'inverse', category: 'biotech'},
            {ticker: 'FNGU', name: 'MicroSectors FANG+ Index 3X Bull', price: 23.45, change: 6.7, volume: 13000000, leverage: '3x', category: 'tech'},
            {ticker: 'FNGD', name: 'MicroSectors FANG+ Index 3X Bear', price: 12.78, change: -6.5, volume: 12500000, leverage: 'inverse', category: 'tech'},
            {ticker: 'UDOW', name: 'ProShares UltraPro Dow30', price: 67.89, change: 1.7, volume: 12000000, leverage: '3x', category: 'broad'},
            {ticker: 'SDOW', name: 'ProShares UltraPro Short Dow30', price: 9.43, change: -1.6, volume: 11500000, leverage: 'inverse', category: 'broad'},
            {ticker: 'TNA', name: 'Direxion Daily Small Cap Bull 3X', price: 34.56, change: 3.8, volume: 11000000, leverage: '3x', category: 'small'},
            {ticker: 'TZA', name: 'Direxion Daily Small Cap Bear 3X', price: 13.21, change: -3.7, volume: 10500000, leverage: 'inverse', category: 'small'},
            {ticker: 'FAS', name: 'Direxion Daily Financial Bull 3X', price: 89.12, change: 2.3, volume: 10000000, leverage: '3x', category: 'financial'},
            {ticker: 'FAZ', name: 'Direxion Daily Financial Bear 3X', price: 6.78, change: -2.2, volume: 9500000, leverage: 'inverse', category: 'financial'},
            {ticker: 'CURE', name: 'Direxion Daily Healthcare Bull 3X', price: 45.67, change: 1.4, volume: 9000000, leverage: '3x', category: 'healthcare'},
            {ticker: 'SICK', name: 'Direxion Daily Healthcare Bear 3X', price: 12.34, change: -1.3, volume: 8500000, leverage: 'inverse', category: 'healthcare'},
            {ticker: 'WEBL', name: 'Direxion Daily Dow Jones Internet Bull 3X', price: 18.90, change: 4.2, volume: 8000000, leverage: '3x', category: 'tech'},
            {ticker: 'WEBS', name: 'Direxion Daily Dow Jones Internet Bear 3X', price: 23.45, change: -4.1, volume: 7500000, leverage: 'inverse', category: 'tech'},
            {ticker: 'NAIL', name: 'Direxion Daily Homebuilders Bull 3X', price: 56.78, change: 2.9, volume: 7000000, leverage: '3x', category: 'realestate'},
            {ticker: 'RETL', name: 'Direxion Daily Retail Bull 3X', price: 34.12, change: 3.4, volume: 6500000, leverage: '3x', category: 'retail'},
            {ticker: 'ERX', name: 'Direxion Daily Energy Bull 2X', price: 78.90, change: 4.6, volume: 6000000, leverage: '2x', category: 'energy'},
            {ticker: 'ERY', name: 'Direxion Daily Energy Bear 2X', price: 11.23, change: -4.5, volume: 5500000, leverage: 'inverse', category: 'energy'},
            {ticker: 'DPST', name: 'Direxion Daily Regional Banks Bull 3X', price: 67.45, change: 1.8, volume: 5000000, leverage: '3x', category: 'financial'},
            {ticker: 'DRIP', name: 'Direxion Daily S&P Oil & Gas Bull 2X', price: 23.67, change: 5.1, volume: 4500000, leverage: '2x', category: 'energy'},
            // Îçî ÎßéÏùÄ ETF Îç∞Ïù¥ÌÑ∞...
        ];

        // Ï†ÑÏó≠ Î≥ÄÏàòÎì§Ïù¥ Ïù¥ÎØ∏ ÏúÑÏóêÏÑú ÏÑ†Ïñ∏ÎêòÏóàÏúºÎØÄÎ°ú Ïó¨Í∏∞ÏÑúÎäî Ï†úÍ±∞

        function generateMoreETFs() {
            const baseETFs = [...leverageETFs];
            const additionalTickers = [
                'ARKK', 'SARK', 'DFEN', 'MOON', 'CHAD', 'GUSH', 'DRIP', 'BOIL', 'KOLD',
                'JNUG', 'JDST', 'NUGT', 'DUST', 'UCO', 'SCO', 'UNG', 'DGAZ', 'TVIX',
                'XIV', 'VXX', 'UVXY', 'SVXY', 'SPXL', 'SPXS', 'TMF', 'TMV', 'TLT',
                'TBT', 'UUP', 'UDN', 'GLD', 'SLV', 'USO', 'UGA', 'DBA', 'CORN'
            ];

            // 100Í∞úÍπåÏßÄ Ï±ÑÏö∞Í∏∞ ÏúÑÌï¥ Ï∂îÍ∞Ä Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ±
            for (let i = baseETFs.length; i < 100; i++) {
                const ticker = additionalTickers[i - baseETFs.length] || `ETF${i}`;
                baseETFs.push({
                    ticker: ticker,
                    name: `Leveraged ETF ${ticker}`,
                    price: Math.random() * 100 + 10,
                    change: (Math.random() - 0.5) * 10,
                    volume: Math.floor(Math.random() * 5000000) + 1000000,
                    leverage: ['2x', '3x', 'inverse'][Math.floor(Math.random() * 3)],
                    category: ['tech', 'broad', 'financial', 'energy', 'healthcare'][Math.floor(Math.random() * 5)]
                });
            }
            return baseETFs;
        }

        function updateRanking() {
            const rankRange = parseInt(document.getElementById('rankRange').value);
            const leverageType = document.getElementById('leverageType').value;
            
            // Ïã§ÏãúÍ∞Ñ Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö© (ÏóÜÏúºÎ©¥ Ìè¥Î∞± Îç∞Ïù¥ÌÑ∞)
            let data = realTimeData.length > 0 ? [...realTimeData] : [...leverageETFs];
            
            if (leverageType !== 'all') {
                data = data.filter(etf => etf.leverage === leverageType);
            }
            
            // ÌïúÍµ≠Ïù∏ ÏÑ†Ìò∏ÎèÑÏôÄ Í±∞ÎûòÎüâÏùÑ Í≤∞Ìï©Ìïú Ï†êÏàòÎ°ú Ï†ïÎ†¨
            data.sort((a, b) => {
                const scoreA = (a.volume || 0) * (a.koreanPopularity || 0.5);
                const scoreB = (b.volume || 0) * (b.koreanPopularity || 0.5);
                return scoreB - scoreA;
            });
            
            // ÏÉÅÏúÑ NÍ∞úÎßå ÏÑ†ÌÉù
            filteredData = data.slice(0, rankRange);
            currentData = filteredData;
            
            renderTable();
            updateStats();
            updateTitle();
        }

        function renderTable() {
            const tbody = document.getElementById('rankingBody');
            tbody.innerHTML = '';
            
            currentData.forEach((etf, index) => {
                const row = document.createElement('tr');
                const rank = index + 1;
                const rankClass = rank <= 3 ? `rank-${rank}` : 'rank-other';
                
                row.innerHTML = `
                    <td>
                        <span class="rank-badge ${rankClass}">${rank}</span>
                    </td>
                    <td>
                        <div class="etf-name">${etf.name}</div>
                        <span class="etf-ticker">${etf.ticker}</span>
                    </td>
                    <td>$${etf.price.toFixed(2)}</td>
                    <td class="${etf.change >= 0 ? 'change-positive' : 'change-negative'}">
                        ${etf.change >= 0 ? '+' : ''}${etf.change.toFixed(2)}%
                    </td>
                    <td>
                        <div class="volume-bar" style="width: ${Math.min((etf.volume || 1000000) / 50000000 * 100, 100)}%">
                            <span class="volume-text">
                                ${etf.volume ? `${(etf.volume / 1000000).toFixed(1)}M` : 'N/A'}
                            </span>
                        </div>
                    </td>
                    <td>
                        <div class="volume-bar" style="width: ${Math.min((etf.volume || 1000000) * (etf.price || 50) / 1000000000 * 100, 100)}%">
                            <span class="volume-text">
                                ‚Ç©${etf.volume && etf.price ? ((etf.volume * etf.price) / 1000000000 * 1300).toFixed(1) : '0.0'}B
                            </span>
                        </div>
                    </td>
                    <td>
                        <span style="background: ${etf.leverage === 'inverse' ? '#dc2626' : '#2563eb'}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px; ${etf.leverage === 'inverse' ? 'box-shadow: 0 0 8px rgba(220, 38, 38, 0.4); font-weight: 600;' : ''}">
                            ${etf.leverage}
                        </span>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateStats() {
            if (currentData.length === 0) return;
            
            const totalVol = currentData.reduce((sum, etf) => {
                const volume = etf.volume || 0;
                const price = etf.price || 0;
                return sum + (volume * price);
            }, 0);
            
            const validChanges = currentData.filter(etf => etf.change !== undefined);
            const avgChange = validChanges.length > 0 ? 
                validChanges.reduce((sum, etf) => sum + etf.change, 0) / validChanges.length : 0;
            
            const topGainer = currentData.length > 0 ? 
                currentData.reduce((max, etf) => (etf.change || 0) > (max.change || 0) ? etf : max, currentData[0]) : 
                { ticker: 'N/A' };
            
            // ÏõêÌôî ÌôòÏÇ∞ (1Îã¨Îü¨ = 1300Ïõê Í∞ÄÏ†ï)
            const totalVolKRW = totalVol * 1300;
            
            document.getElementById('totalVolume').textContent = totalVolKRW > 0 ? 
                `‚Ç©${(totalVolKRW / 1000000000000).toFixed(1)}Ï°∞` : '‚Ç©0Ï°∞';
            document.getElementById('activeETFs').textContent = currentData.length;
            document.getElementById('avgChange').textContent = `${avgChange >= 0 ? '+' : ''}${avgChange.toFixed(1)}%`;
            document.getElementById('topGainer').textContent = topGainer.ticker;
        }

        function updateTitle() {
            const period = currentPeriod === 'daily' ? 'ÏùºÎ≥Ñ' : currentPeriod === 'weekly' ? 'Ï£ºÎ≥Ñ' : 'ÏõîÎ≥Ñ';
            const range = document.getElementById('rankRange').value;
            document.getElementById('rankingTitle').textContent = `${period} Í±∞ÎûòÏàúÏúÑ Top ${range}`;
        }

        function switchPeriod(period) {
            currentPeriod = period;
            
            // ÌÉ≠ Î≤ÑÌäº ÌôúÏÑ±Ìôî
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Ïã§ÏãúÍ∞Ñ Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
            updateRealTimeData();
        }

        function searchETF() {
            const searchTerm = document.getElementById('searchTicker').value.toUpperCase();
            
            if (searchTerm === '') {
                currentData = filteredData;
            } else {
                currentData = filteredData.filter(etf => 
                    etf.ticker.includes(searchTerm) || 
                    etf.name.toUpperCase().includes(searchTerm)
                );
            }
            
            renderTable();
        }

        function showLoading() {
            document.getElementById('loadingDiv').style.display = 'block';
            document.getElementById('rankingTable').style.display = 'none';
        }

        function hideLoading() {
            document.getElementById('loadingDiv').style.display = 'none';
            document.getElementById('rankingTable').style.display = 'table';
        }

        // ÌïúÍµ≠ÏãúÍ∞Ñ Í∏∞Ï§Ä ÏùºÏùº Î∞∞Ïπò ÏãúÏä§ÌÖú Ï¥àÍ∏∞Ìôî
        window.onload = async function() {
            const koreaTime = new Date(getKoreaTime());
            console.log('üìÖ ÌïúÍµ≠ÏãúÍ∞Ñ Í∏∞Ï§Ä ETF Î∞∞Ïπò ÏãúÏä§ÌÖú ÏãúÏûë');
            console.log(`üïê ÌòÑÏû¨ ÌïúÍµ≠ÏãúÍ∞Ñ: ${koreaTime.toLocaleString()}`);
            
            // Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ Î°úÎìú (Ï†ÄÏû•Îêú Îç∞Ïù¥ÌÑ∞ Ïö∞ÏÑ† ÏÇ¨Ïö©)
            await loadStoredData();
            
            // ÌïÑÏöîÌïú Í≤ΩÏö∞ ÏùºÎ≥Ñ Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
            await updatePeriodData('daily');
            updateRanking();
            
            // Îß§Ïùº ÏûêÏ†ï 1Î∂Ñ ÌõÑ ÏûêÎèô ÏóÖÎç∞Ïù¥Ìä∏ ÏÑ§Ï†ï
            scheduleNextUpdate();
            
            console.log('‚úÖ Î∞∞Ïπò ÏãúÏä§ÌÖú Ï§ÄÎπÑ ÏôÑÎ£å');
        };

        // Ï†ÄÏû•Îêú Îç∞Ïù¥ÌÑ∞ Î°úÎìú
        async function loadStoredData() {
            try {
                ['daily', 'weekly', 'monthly'].forEach(period => {
                    const saved = localStorage.getItem(`etf_${period}_data`);
                    if (saved) {
                        const { data, timestamp } = JSON.parse(saved);
                        switch(period) {
                            case 'daily': 
                                dailyData = data; 
                                lastUpdateTimestamp.daily = timestamp;
                                break;
                            case 'weekly': 
                                weeklyData = data; 
                                lastUpdateTimestamp.weekly = timestamp;
                                break;
                            case 'monthly': 
                                monthlyData = data; 
                                lastUpdateTimestamp.monthly = timestamp;
                                break;
                        }
                        console.log(`üìã ${period} Ï†ÄÏû•Îêú Îç∞Ïù¥ÌÑ∞ Î°úÎìúÎê®`);
                    }
                });
            } catch (error) {
                console.warn('Ï†ÄÏû•Îêú Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®:', error);
            }
        }

        // Îã§Ïùå ÏóÖÎç∞Ïù¥Ìä∏ Ïä§ÏºÄÏ§ÑÎßÅ
        function scheduleNextUpdate() {
            const koreaDate = getKoreaDate();
            const now = new Date();
            
            // Îã§Ïùå ÎÇ† 00:01:00Ïóê ÏóÖÎç∞Ïù¥Ìä∏ Ïä§ÏºÄÏ§Ñ
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(0, 1, 0, 0); // ÏûêÏ†ï 1Î∂Ñ ÌõÑ
            
            const timeUntilUpdate = tomorrow.getTime() - now.getTime();
            
            console.log(`‚è∞ Îã§Ïùå ÏûêÎèô ÏóÖÎç∞Ïù¥Ìä∏: ${tomorrow.toLocaleString()}`);
            
            setTimeout(async () => {
                console.log('üåÖ ÏùºÏùº ÏûêÎèô ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÏûë');
                await updatePeriodData('daily');
                await updatePeriodData('weekly');
                await updatePeriodData('monthly');
                
                // ÌòÑÏû¨ ÏÑ†ÌÉùÎêú Í∏∞Í∞Ñ Îç∞Ïù¥ÌÑ∞ Í∞±Ïã†
                updateRanking();
                
                // Îã§Ïùå ÏóÖÎç∞Ïù¥Ìä∏ Ïû¨Ïä§ÏºÄÏ§ÑÎßÅ
                scheduleNextUpdate();
                
            }, timeUntilUpdate);
        }

        // Ïã§ÏãúÍ∞Ñ Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÎÆ¨Î†àÏù¥ÏÖò + Ïã§Ï†ú ÏãúÍ∞Ñ ÌëúÏãú
        setInterval(() => {
            const now = new Date();
            const timeString = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')} ${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')} KST`;
            document.getElementById('lastUpdate').textContent = `ÎßàÏßÄÎßâ ÏóÖÎç∞Ïù¥Ìä∏: ${timeString}`;
            
            // Í∞ÄÍ≤© ÎØ∏ÏÑ∏ Ï°∞Ï†ï (Ïã§ÏãúÍ∞Ñ Î≥ÄÎèô ÏãúÎÆ¨Î†àÏù¥ÏÖò)
            if (currentData.length > 0) {
                currentData.forEach(etf => {
                    const randomChange = (Math.random() - 0.5) * 0.02; // ¬±1% Î≤îÏúÑ ÎØ∏ÏÑ∏ Ï°∞Ï†ï
                    etf.price = Math.max(1, etf.price * (1 + randomChange));
                    etf.change += randomChange * 100;
                });
                
                // 5Î∂ÑÎßàÎã§ ÌÖåÏù¥Î∏î Í∞±Ïã†
                if (now.getMinutes() % 5 === 0 && now.getSeconds() === 0) {
                    renderTable();
                }
            }
        }, 1000); // 1Ï¥àÎßàÎã§ ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏
    </script>
</body>
</html>
